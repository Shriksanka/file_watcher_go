# File Upload Monitor

Приложение на Go для автоматической отправки файлов из папки Downloads на API endpoint.

## Особенности

- ✅ **Графический интерфейс** с тускло-бирюзовым фоном
- ✅ **Кнопка Start/Stop** для управления обработкой файлов
- ✅ **Логи в реальном времени** - видно, какие файлы обрабатываются
- ✅ Отслеживает папку Downloads (Windows и macOS)
- ✅ Отправляет файлы только после полной загрузки
- ✅ Гарантирует отправку каждого файла только один раз
- ✅ Не реагирует на открытие или другие взаимодействия с файлами
- ✅ Проверяет стабильность файла перед отправкой

## Установка зависимостей

```bash
go mod download
```

Или автоматически при компиляции:

```bash
go mod tidy
```

## Компиляция

### Для macOS

**Вариант 1: Простая сборка (с консолью)**

```bash
go build -o file-upload-monitor-macos main.go
./file-upload-monitor-macos
```

**Вариант 2: .app приложение (БЕЗ консоли) - РЕКОМЕНДУЕТСЯ**

Используйте готовый скрипт:

```bash
./build.sh
```

Или вручную:

```bash
# Создать директорию для .app
mkdir -p FileUploadMonitor.app/Contents/MacOS

# Скомпилировать
go build -o FileUploadMonitor.app/Contents/MacOS/FileUploadMonitor main.go

# Создать Info.plist (уже создан, если использовали build.sh)
```

**Запуск .app приложения:**

- Дважды кликните на `FileUploadMonitor.app` в Finder
- Или через терминал: `open FileUploadMonitor.app`

Приложение запустится **без консоли** - только графическое окно!

### Для Windows

```bash
# На macOS/Linux для кросс-компиляции Windows
GOOS=windows GOARCH=amd64 go build -o file-upload-monitor.exe main.go

# Или на Windows напрямую
go build -o file-upload-monitor.exe main.go
```

### Для Linux

```bash
GOOS=linux GOARCH=amd64 go build -o file-upload-monitor-linux main.go
```

## Запуск

**macOS (рекомендуется - без консоли):**

```bash
open FileUploadMonitor.app
```

Или просто дважды кликните на `FileUploadMonitor.app` в Finder.

**macOS (с консолью):**

```bash
./file-upload-monitor-macos
```

**Windows:**

```bash
file-upload-monitor.exe
```

**Linux:**

```bash
./file-upload-monitor-linux
```

При запуске откроется окно с графическим интерфейсом:

- **Область логов** - показывает все события обработки файлов
- **Кнопка START/STOP** - внизу по центру для управления обработкой

### Использование

1. Нажмите кнопку **START** для начала отслеживания папки Downloads
2. Когда файл скачивается в Downloads, он автоматически обрабатывается и отправляется
3. Нажмите кнопку **STOP** чтобы временно остановить обработку (например, при скачивании подтверждений транзакций)
4. Снова нажмите **START** чтобы возобновить обработку

## Как это работает

1. Приложение отслеживает папку Downloads на наличие новых файлов
2. Когда файл появляется в папке, начинается проверка его стабильности
3. Файл считается полностью загруженным, если его размер и время модификации не изменяются в течение 2 секунд
4. После подтверждения стабильности файл отправляется на API endpoint
5. Каждый файл отправляется только один раз (отслеживается в памяти)

## API Endpoint

Файлы отправляются на:

```
api/statements/upload
```

Формат запроса: `multipart/form-data` с полем `file`

## Настройки

Вы можете изменить следующие константы в `main.go`:

- `fileStabilityDelay` - время ожидания стабильности файла (по умолчанию 2 секунды)
- `checkInterval` - интервал проверки размера файла (по умолчанию 500 мс)
- `apiEndpoint` - URL API endpoint

## Логирование

Приложение выводит логи в окне приложения:

- Информация о запуске и отслеживаемой папке
- Сообщения о начале обработки файлов (с временными метками)
- Результаты отправки (успех или ошибка)
- Все логи автоматически прокручиваются вниз

## Требования

- Go 1.21 или выше
- Доступ к папке Downloads
- Интернет-соединение для отправки файлов
- Для компиляции с UI требуется CGO (обычно включен по умолчанию)

## UI Особенности

- **Тускло-бирюзовый фон** (#AFEEEE) для комфортной работы
- **Кнопка Start/Stop** внизу по центру для управления
- **Автоматическая прокрутка логов** - всегда видно последние события
- **Ограничение логов** - хранятся последние 100 строк для производительности
